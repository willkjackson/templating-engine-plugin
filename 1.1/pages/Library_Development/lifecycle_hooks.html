

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Leverage Lifecycle Hooks &mdash; Jenkins Templating Engine  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Defining Non-Call Methods in Library Steps" href="noncall_methods.html" />
    <link rel="prev" title="Library Sources" href="library_sources.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Jenkins Templating Engine
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Templating/index.html">Pipeline Templating</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Templating/configuration_files/index.html">Configuration Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Templating/configuration_files/default_step_implementation.html">Default Step Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Templating/configuration_files/sandboxing.html">Sandboxing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Templating/primitives/index.html">Primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Templating/primitives/application_environments.html">Application Environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Templating/primitives/keywords.html">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Templating/primitives/stages.html">Stages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Governance/index.html">Governance Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Governance/conditional_inheritance.html">Conditional Inheritance Examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Library Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="externalizing_config.html">Externalizing Library Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="library_sources.html">Library Sources</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Leverage Lifecycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="noncall_methods.html">Defining Non-Call Methods in Library Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="validate_library_parameters.html">Validate Library Parameters</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Jenkins Templating Engine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Library Development</a> &raquo;</li>
        
      <li>Leverage Lifecycle Hooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/pages/Library_Development/lifecycle_hooks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../../master/pages/Library_Development/lifecycle_hooks.html"><b>Warning:</b> This document is for an old version of Jenkins Templating Engine. The main version is master.</a></p>
<div class="section" id="leverage-lifecycle-hooks">
<span id="id1"></span><h1>Leverage Lifecycle Hooks<a class="headerlink" href="#leverage-lifecycle-hooks" title="Permalink to this headline">¶</a></h1>
<p>Sometimes it is necessary to trigger specific pipeline actions at certain times
during pipeline execution. For example, if you wanted to send multiple notification
types after a particular pipeline step or at the conclusion of a pipeline if the
build was failure.</p>
<p>JTE supports this type of Aspect Oriented Programming style event handling through
annotation markers that can be placed on library steps.</p>
<p>The following lifecycle hook annotations are available:</p>
<table border="1" class="docutils align-center" id="id2">
<caption><span class="caption-text">JTE LifeCycle Hook annotations</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Annotation</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&#64;Init</span></code></td>
<td>Will get executed at the beginning of a pipeline run</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&#64;BeforeStep</span></code></td>
<td>Will get executed before every pipeline step invocation</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&#64;AfterStep</span></code></td>
<td>Will get executed after every pipeline step invocation</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&#64;CleanUp</span></code></td>
<td>Will get executed at the end of a pipeline run</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&#64;Notify</span></code></td>
<td>Will get executed after every pipeline step invocation as well as at the end of the pipeline run</td>
</tr>
</tbody>
</table>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>In order to write a pipeline step leveraging one of these lifecycle hooks,
you must annotate the step with the annotation and accept a context input
parameter to the method.</p>
<p>This context parameter provides context so that the step can vary its
behavior based on what just happened in the pipeline.</p>
<table border="1" class="docutils align-center" id="id3">
<caption><span class="caption-text">JTE LifeCycle Hook Context Parameter</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">context.library</span></code></td>
<td>The name of the Library that contributed the step associated with the hook</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">context.step</span></code></td>
<td>The name of the Step associated with the hook</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">context.status</span></code></td>
<td>The current pipeline build status</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><code class="docutils literal"><span class="pre">context.library</span></code> and <code class="docutils literal"><span class="pre">context.step</span></code> will be <code class="docutils literal"><span class="pre">null</span></code> before and after pipeline execution
and are only to be leveraged by <code class="docutils literal"><span class="pre">&#64;BeforeStep</span></code>, <code class="docutils literal"><span class="pre">&#64;AfterStep</span></code>, and <code class="docutils literal"><span class="pre">&#64;Notify</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The reference to the variable name <code class="docutils literal"><span class="pre">context</span></code> makes the assumption that you’ve named the
input parameter to the step with the hook annotation <code class="docutils literal"><span class="pre">context</span></code>.  In practice, this variable
name can be whatever you please</p>
</div>
</div>
<div class="section" id="example-implementation">
<h2>Example Implementation<a class="headerlink" href="#example-implementation" title="Permalink to this headline">¶</a></h2>
<p>Let’s say we wanted to print to the console log a specific message when the
<code class="docutils literal"><span class="pre">build</span></code> step fails to execute successfully.</p>
<div class="section" id="step-1-create-a-library">
<h3>Step 1: Create a Library<a class="headerlink" href="#step-1-create-a-library" title="Permalink to this headline">¶</a></h3>
<p>Within one of your configured <a class="reference internal" href="library_sources.html#pipeline-libraries"><span class="std std-ref">library sources</span></a>, create a new
directory.  For this example, let’s call the library <code class="docutils literal"><span class="pre">slack</span></code></p>
<p><strong>Repository Structure</strong>:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">README</span><span class="o">.</span><span class="n">rst</span>
<span class="n">slack</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-create-the-step">
<h3>Step 2: Create the Step<a class="headerlink" href="#step-2-create-the-step" title="Permalink to this headline">¶</a></h3>
<p>When creating steps whose only purpose is to be invoked at a particular
stage of the pipeline, the name of the step does not matter because it
is not being called via a pipeline template.  These steps are discovered
by JTE and invoked dynamically.</p>
<p>This means that if there are multiple steps with the same annotation
they will all be executed. This is useful for situations such as
creating pipeline templates to be used by multiple teams all using
different tools to receive pipeline notifications - or using multiple
notification tools (email, slack, sms, etc).</p>
<p>For this example, we’ll call the step <code class="docutils literal"><span class="pre">sendSlackNotification</span></code>.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">README</span><span class="o">.</span><span class="n">rst</span>
<span class="n">slack</span><span class="o">/</span>
    <span class="n">sendSlackNotification</span><span class="o">.</span><span class="n">groovy</span>
</pre></div>
</div>
<p>We must remember to annotate the method and pass the step a context
input parameter.  Remember, our goal is to create a step that sends
a message when the <code class="docutils literal"><span class="pre">build</span></code> step fails.</p>
<p><strong>sendSlackNotification.groovy</strong>:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="nd">@AfterStep</span>
<span class="n">void</span> <span class="n">call</span><span class="p">(</span><span class="n">context</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;build&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">context</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;FAILURE&quot;</span><span class="p">)){</span>
        <span class="n">slackSend</span> <span class="n">color</span><span class="p">:</span> <span class="s1">&#39;#ff0000&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s2">&quot;Build Failure: $</span><span class="si">{env.JOB_URL}</span><span class="s2">&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example assumes you’ve installed and appropriately configured the
<a class="reference external" href="https://jenkins.io/doc/pipeline/steps/slack/">Slack Notification Plugin</a></p>
</div>
</div>
<div class="section" id="step-3-load-the-library">
<h3>Step 3: Load the Library<a class="headerlink" href="#step-3-load-the-library" title="Permalink to this headline">¶</a></h3>
<p>With the library created and slack notification step written all you have
to do to send a slack notification after the <code class="docutils literal"><span class="pre">build</span></code> step fails is
load the <code class="docutils literal"><span class="pre">slack</span></code> library in your pipeline configuration file.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">libraries</span><span class="p">{</span>
    <span class="n">slack</span>
<span class="p">}</span>
</pre></div>
</div>
<p>JTE will automatically pick up that a library has been loaded that
contributes steps with lifecycle hook annotations.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="noncall_methods.html" class="btn btn-neutral float-right" title="Defining Non-Call Methods in Library Steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="library_sources.html" class="btn btn-neutral float-left" title="Library Sources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Booz Allen Hamilton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 1.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../../1.0.0/pages/Library_Development/lifecycle_hooks.html">1.0.0</a></dd>
            <dd><a href="lifecycle_hooks.html">1.1</a></dd>
            <dd><a href="../../../1.1.1/pages/Library_Development/lifecycle_hooks.html">1.1.1</a></dd>
            <dd><a href="../../../1.3/pages/Library_Development/lifecycle_hooks.html">1.3</a></dd>
            <dd><a href="../../../1.4/pages/Library_Development/lifecycle_hooks.html">1.4</a></dd>
            <dd><a href="../../../1.4.1/pages/Library_Development/lifecycle_hooks.html">1.4.1</a></dd>
            <dd><a href="../../../v0.1-alpha/pages/Library_Development/lifecycle_hooks.html">v0.1-alpha</a></dd>
            <dd><a href="../../../v1.2/pages/Library_Development/lifecycle_hooks.html">v1.2</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../master/pages/Library_Development/lifecycle_hooks.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>